#!/usr/bin/env sh

# Description: ğŸ“ Validates that each component has a corresponding story file
# Author: ğŸ‘¨â€ğŸ’» Rafael da Costa Nunes
# Date: ğŸ“… March 2023

# Load husky
. "$(dirname -- "$0")/_/husky.sh"
echo "ğŸ¶ Husky loaded"

# Run unit tests
echo "ğŸƒ Running unit tests..."
npm run test:unit

# Validate component stories
echo "ğŸ•µï¸â€â™€ï¸ Validating component stories..."
for folder in "src/components/atoms" "src/components/molecules" "src/components/organisms"; do
  for file in $(find "$folder" -type f -name "*.vue"); do
    componentName=$(basename "$(dirname "$file")")
    if [ ! -f "$(dirname "$file")/${componentName}.stories.js" ] && [ ! -f "$(dirname "$file")/${componentName}.stories.mdx" ]; then
      echo "âŒ ERROR: No story file found for $componentName in $(dirname "$file")"
      exit 1
    else
      echo "âœ… SUCCESS: $componentName has a corresponding story file"
    fi
  done
done

# Validate component tests
echo "ğŸ•µï¸â€â™€ï¸ Validating component tests..."
for folder in "src/components/atoms" "src/components/molecules" "src/components/organisms"; do
  for file in $(find "$folder" -type f -name "*.vue"); do
    componentName=$(basename "$(dirname "$file")")
    if [ ! -f "tests/unit/${componentName}.spec.js" ]; then
      echo "âŒ ERROR: No test file found for $componentName in tests/unit/"
      exit 1
    else
      echo "âœ… SUCCESS: $componentName has a corresponding test file"
    fi
  done
done
